<?php
class CommentAction extends Action {

    public function _initialize() {
        $Config = A('Config');
        $Config->checkLogIn();
        $Config->checkUserLevel(array('1'));
    }
    
    public function index() {
        $Comment = M('Comment');
        import("ORG.Util.Page");
        
        $count = $Comment->count();
        $Page = new Page($count, 25);
        $comment = $Comment->join(array('news_user ON news_user.user_id = news_comment.user_id'))->order(array('news_comment.add_time' => 'desc', 'news_comment.comment_id' => 'desc'))->limit($Page->firstRow . ',' . $Page->listRows)->select();
        
        $this->assign('cat_id', $id);
        $this->assign('comment', $comment);
        
        $show = $Page->show();
        $this->assign('page',$show);
        
        $this->display();
    }
    
    // 删除评论
    public function delete() {
        if (isset($_GET['id'])) {
            $id = (int) $_GET['id'];
            $Comment = M('Comment');
            
            if ($Comment->delete($id)) {
                $this->success('成功删除评论！');
            } else {
                $this->error('删除评论失败！');
            }
        }
    }
    
    public function verify() {
        if (isset($_GET['id'])) {
            $id = (int) $_GET['id'];
            $Comment = M('Comment');
            $Comment->comment_id = $id;
            $comment = $Comment->find($id);

            if ($Comment->status == 0) {
                $Comment->status = 1;
            } else {
                $Comment->status = 0;
            }
            
            if (false !== $Comment->save()) {
                $this->success('操作成功！');
            } else {
                $this->error('操作失败！');
            }
        }
    }
}
?>