<?php

/**
 * Description of SearchAction.class.php 
 *
 * @author Administrator
 */
class SearchAction extends Action {

    public function index() {
        
        try {
            $solr = new Service('192.168.86.34', '8080', '/solr/product');
        } catch (Exception $e) {
            echo $e->getMessage();
        }
        if (!$solr->ping()) {
            echo 'Solr service not responding.';
            exit;
        }
        $params = array(
            'facet' => 'true',
            'facet.field' => 'compId',
            'facet.limit' => '1000',
            'facet.mincount' => '1'
        );

        $q = array(
            'attrValues' => 'Ceramics',
            'attrValues' => 'Reflector'
        );
        try {
            $response = $solr->search('productName:Bulb AND (attrValues:Ceramics AND attrValues:Reflector)', 0, 10, $params);
        } catch (Exception $e) {
            echo 'unexpected error happen';
            exit;
        }

// var_dump($response->getRawResponse() );
        var_dump(json_decode($response->getRawResponse()));

        $responseObj = json_decode($response->getRawResponse());

        var_dump($responseObj->facet_counts);
        var_dump($responseObj->response->docs);
    }
    
    public function func(){
        $Solr = D('Search');
        $Solr->searchProductBycompId('led bulb' , '' ,'220V Ceramics' , '' ,' 1704200 1714875 1722005 1820448' );
    }
    
    public function func1(){
	$Solr = D('Search');
        $Solr->searchCompByFacet('led bulb' , '' ,'220V Ceramics' , ''  );
    }
    
    public function fun1(){
	$Solr = D('Search');
	//用于名字搜索，可以规定一定要匹配吗，中间的空格不影响后果  
	//$Solr->test(' features:"dynamic     Bearing"');
	
	//用于对属性的查找
	//$Solr->test('features:OF AND features:UP AND features:CoLor');
	
	//用于综合的搜索 text_general
	//$Solr->test('name:"CanOn MP500  "  AND (features:OF AND features:UP AND features:CoLor)');
	
	
	//用于综合的搜索 stirng
	//$Solr->test('(cat:lectronics AND cat:music )');
	
	//用于测试不同的查询解析器，默认为standard lucenne
	$Solr->dismax('cache  hard ');
	
	
    }
    
}