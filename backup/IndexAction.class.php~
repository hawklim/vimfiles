<?php
class IndexAction extends Action {

    public function _initialize() {
        $Setting = M('Setting');
        $setting = $Setting->find(1);
        
        $this->assign('setting', $setting);
    }
    
	public function index() {
		echo 1;
		exit;
        $Article = M('Article');
        
        $thumb_news = $Article->where(array('thumb' => array('neq', '')))->order(array('add_time' => 'desc'))->limit(5)->select();
        
        $img_path = '';
        $target = '';
        foreach($thumb_news as $value) {
            $img_path .= __ROOT__ . '/Public/Uploads/thumb/' . $value['thumb'] . '|';
            $target .= U('Article/entry?id=' . $value['article_id']) . '|';
        }
        $img_path = substr($img_path, 0, -1);
        $target = substr($target, 0, -1);
        
        $this->assign('img_path', $img_path);
        $this->assign('target', $target);
        $this->assign('thumb_news', $thumb_news);
        
        $news = $Article->where(array('cat_id' => 1))->order(array('list_order' => 'desc', 'article_id' => 'desc'))->limit(10)->select();
        $hot = $Article->where(array('cat_id' => 2))->order(array('list_order' => 'desc', 'article_id' => 'desc'))->limit(10)->select();
        $announcement = $Article->where(array('cat_id' => 3))->order(array('list_order' => 'desc', 'add_time' => 'desc', 'article_id' => 'desc'))->limit(11)->select();
        
        $this->assign('news', $news);
        $this->assign('hot', $hot);
        $this->assign('announcement', $announcement);
        
        $img_news = $Article->where(array('thumb' => array('neq', ''), 'cat_id' => 1))->order(array('list_order' => 'desc', 'article_id' => 'desc'))->find();
        $this->assign('img_news', $img_news);
        
        $img_hot = $Article->where(array('thumb' => array('neq', ''), 'cat_id' => 2))->order(array('list_order' => 'desc', 'article_id' => 'desc'))->find();
        $this->assign('img_hot', $img_hot);
        
        $this->display();
    }
    
    /* 关于 */
    public function about() {
        $Article = M('Article');
        $news = $Article->where(array('cat_id' => 3))->order(array('list_order' => 'desc', 'add_time' => 'desc', 'article_id' => 'desc'))->limit(5)->select();
        $this->assign('news', $news);
        
        $Setting = M('Setting');
        $setting = $Setting->find(1);
        $this->assign('mailbox', $setting['mailbox']);
        $this->display();
    }

    /**
    +----------------------------------------------------------
    * 探针模式
    +----------------------------------------------------------
    */
    public function checkEnv() {
        load('pointer',THINK_PATH.'/Tpl/Autoindex');//载入探针函数
        $env_table = check_env();//根据当前函数获取当前环境
        echo $env_table;
    }
    
}
?>
